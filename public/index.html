<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSINT Investigation Platform</title>
    <link href="/styles/output.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.8/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [activeTab, setActiveTab] = useState('deep');
            const [username, setUsername] = useState('');
            const [query, setQuery] = useState('');
            const [url, setUrl] = useState('');
            const [usernames, setUsernames] = useState('');
            const [platform, setPlatform] = useState('tiktok');
            const [sources, setSources] = useState({ bing: true, duckduckgo: true });
            const [results, setResults] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const menuItems = [
                { id: 'deep', icon: '🔍', label: 'Deep Investigation' },
                { id: 'social', icon: '🌐', label: 'Social Media Search' },
                { id: 'advanced', icon: '🔎', label: 'Advanced Search' },
                { id: 'capture', icon: '📸', label: 'Website Capture' },
                { id: 'batch', icon: '📜', label: 'Batch Investigation' },
                { id: 'health', icon: '⚙️', label: 'System Health' }
            ];

            const platforms = ['tiktok', 'facebook', 'instagram', 'youtube', 'twitter', 'linkedin', 'github', 'reddit'];

            const handleSearch = async (endpoint, payload) => {
                setLoading(true);
                setError(null);
                try {
                    const response = await axios.post(endpoint, payload);
                    setResults(response.data);
                } catch (err) {
                    setError(err.response?.data?.error || 'An error occurred');
                } finally {
                    setLoading(false);
                }
            };

            const handleHealthCheck = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await axios.get('/health');
                    setResults(response.data);
                } catch (err) {
                    setError(err.response?.data?.error || 'An error occurred');
                } finally {
                    setLoading(false);
                }
            };

            const ProfileCard = ({ profile }) => (
                <div className="bg-gray-800 rounded-lg p-4 shadow-lg hover:shadow-xl transition-shadow">
                    <div className="flex items-center space-x-4">
                        {profile.profilePic && (
                            <img src={profile.profilePic} alt="Profile" className="w-16 h-16 rounded-full object-cover" />
                        )}
                        <div>
                            <h3 className="text-lg font-semibold text-white">{profile.title || 'Unknown'}</h3>
                            <p className="text-sm text-gray-400">{profile.platform}</p>
                            <a href={profile.url} target="_blank" className="text-blue-400 hover:underline">{profile.url}</a>
                        </div>
                    </div>
                    {profile.bio && <p過程className="mt-2 text-gray-300">{profile.bio}</p>}
                    {profile.followers && <p className="text-gray-400">Followers: {profile.followers}</p>}
                    {profile.postCount && <p className="text-gray-400">Posts: {profile.postCount}</p>}
                    {profile.snippet && <p className="mt-2 text-gray-300">{profile.snippet}</p>}
                    {profile.screenshot && (
                        <img src={profile.screenshot} alt="Screenshot" className="mt-2 rounded-lg max-w-full" />
                    )}
                </div>
            );

            const CaptureCard = ({ capture }) => (
                <div className="bg-gray-800 rounded-lg p-4 shadow-lg hover:shadow-xl transition-shadow">
                    <h3 className="text-lg font-semibold text-white">{capture.title || 'Website Capture'}</h3>
                    <a href={capture.url} target="_blank" className="text-blue-400 hover:underline">{capture.url}</a>
                    {capture.description && <p className="mt-2 text-gray-300">{capture.description}</p>}
                    {capture.screenshot && (
                        <img src={capture.screenshot} alt="Screenshot" className="mt-2 rounded-lg max-w-full" />
                    )}
                    {capture.error && <p className="text-red-400">Error: {capture.error}</p>}
                </div>
            );

            const renderResults = () => {
                if (!results) return null;
                if (activeTab === 'deep') {
                    return (
                        <div>
                            {Object.entries(results.investigation.social_media).map(([platform, profiles]) => (
                                <div key={platform}>
                                    <h2 className="text-xl font-bold text-white mb-4">{platform.charAt(0).toUpperCase() + platform.slice(1)}</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {profiles.map((profile, index) => (
                                            <ProfileCard key={index} profile={profile} />
                                        ))}
                                    </div>
                                </div>
                            ))}
                            <h2 className="text-xl font-bold text-white mb-4">General Search</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {results.investigation.general_search.map((result, index) => (
                                    <ProfileCard key={index} profile={result} />
                                ))}
                            </div>
                        </div>
                    );
                } else if (activeTab === 'social') {
                    return (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {results.results.map((profile, index) => (
                                <ProfileCard key={index} profile={profile} />
                            ))}
                        </div>
                    );
                } else if (activeTab === 'advanced') {
                    return (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {results.results.map((result, index) => (
                                <ProfileCard key={index} profile={result} />
                            ))}
                        </div>
                    );
                } else if (activeTab === 'capture') {
                    return <CaptureCard capture={results.capture} />;
                } else if (activeTab === 'batch') {
                    return (
                        <div>
                            {results.investigations.map((investigation, index) => (
                                <div key={index}>
                                    <h2 className="text-xl font-bold text-white mb-4">Username: {investigation.username}</h2>
                                    {Object.entries(investigation.social_media).map(([platform, profiles]) => (
                                        <div key={platform}>
                                            <h3 className="text-lg font-semibold text-white mb-2">{platform.charAt(0).toUpperCase() + platform.slice(1)}</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                {profiles.map((profile, idx) => (
                                                    <ProfileCard key={idx} profile={profile} />
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    );
                } else if (activeTab === 'health') {
                    return (
                        <div className="bg-gray-800 rounded-lg p-4 shadow-lg">
                            <h2 className="text-xl font-bold text-white mb-4">System Health</h2>
                            <p><strong>Status:</strong> {results.status}</p>
                            <p><strong>Version:</strong> {results.version}</p>
                            <p><strong>Uptime:</strong> {Math.round(results.uptime)} seconds</p>
                            <p><strong>Supported Platforms:</strong> {results.supported_platforms.join(', ')}</p>
                            <p><strong>Features:</strong> {results.features.join(', ')}</p>
                        </div>
                    );
                }
                return null;
            };

            return (
                <div className="flex h-screen">
                    <div className="w-16 bg-gray-800 flex flex-col items-center py-4 space-y-6">
                        {menuItems.map(item => (
                            <button
                                key={item.id}
                                onClick={() => setActiveTab(item.id)}
                                className={`text-2xl p-2 rounded-lg ${activeTab === item.id ? 'bg-blue-600 text-white' : 'text-gray-400 hover:text-white'}`}
                                title={item.label}
                            >
                                {item.icon}
                            </button>
                        ))}
                    </div>
                    <div className="flex-1 p-6">
                        <div className="max-w-4xl mx-auto">
                            {activeTab === 'deep' && (
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-4">Deep Investigation</h1>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        placeholder="Enter username"
                                        className="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg text-white mb-4"
                                    />
                                    <button
                                        onClick={() => handleSearch('/api/investigate', { username })}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                                        disabled={loading}
                                    >
                                        {loading ? 'Investigating...' : 'Start Investigation'}
                                    </button>
                                </div>
                            )}
                            {activeTab === 'social' && (
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-4">Social Media Search</h1>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        placeholder="Enter username"
                                        className="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg text-white mb-4"
                                    />
                                    <select
                                        value={platform}
                                        onChange={(e) => setPlatform(e.target.value)}
                                        className="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg text-white mb-4"
                                    >
                                        {platforms.map(p => (
                                            <option key={p} value={p}>{p.charAt(0).toUpperCase() + p.slice(1)}</option>
                                        ))}
                                    </select>
                                    <button
                                        onClick={() => handleSearch(`/api/search/${platform}`, { username })}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                                        disabled={loading}
                                    >
                                        {loading ? 'Searching...' : 'Search Social Media'}
                                    </button>
                                </div>
                            )}
                            {activeTab === 'advanced' && (
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-4">Advanced Search</h1>
                                    <input
                                        type="text"
                                        value={query}
                                        onChange={(e) => setQuery(e.target.value)}
                                        placeholder="Enter search query"
                                        className="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg text-white mb-4"
                                    />
                                    <div className="flex space-x-4 mb-4">
                                        <label className="flex items-center">
                                            <input
                                                type="checkbox"
                                                checked={sources.bing}
                                                onChange={() => setSources({ ...sources, bing: !sources.bing })}
                                                className="mr-2"
                                            />
                                            Bing
                                        </label>
                                        <label className="flex items-center">
                                            <input
                                                type="checkbox"
                                                checked={sources.duckduckgo}
                                                onChange={() => setSources({ ...sources, duckduckgo: !sources.duckduckgo })}
                                                className="mr-2"
                                            />
                                            DuckDuckGo
                                        </label>
                                    </div>
                                    <button
                                        onClick={() => handleSearch('/api/advanced-search', { query, sources: Object.keys(sources).filter(k => sources[k]) })}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                                        disabled={loading}
                                    >
                                        {loading ? 'Searching...' : 'Execute Search'}
                                    </button>
                                </div>
                            )}
                            {activeTab === 'capture' && (
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-4">Website Capture</h1>
                                    <input
                                        type="text"
                                        value={url}
                                        onChange={(e) => setUrl(e.target.value)}
                                        placeholder="Enter URL"
                                        className="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg text-white mb-4"
                                    />
                                    <button
                                        onClick={() => handleSearch('/api/capture', { url })}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                                        disabled={loading}
                                    >
                                        {loading ? 'Capturing...' : 'Capture & Analyze'}
                                    </button>
                                </div>
                            )}
                            {activeTab === 'batch' && (
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-4">Batch Investigation</h1>
                                    <textarea
                                        value={usernames}
                                        onChange={(e) => setUsernames(e.target.value)}
                                        placeholder="Enter usernames (one per line)"
                                        className="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg text-white mb-4 h-32"
                                    />
                                    <button
                                        onClick={() => handleSearch('/api/batch-investigate', { usernames: usernames.split('\n').filter(u => u.trim()) })}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                                        disabled={loading}
                                    >
                                        {loading ? 'Investigating...' : 'Start Batch Analysis'}
                                    </button>
                                </div>
                            )}
                            {activeTab === 'health' && (
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-4">System Health</h1>
                                    <button
                                        onClick={handleHealthCheck}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                                        disabled={loading}
                                    >
                                        {loading ? 'Checking...' : 'Check System Health'}
                                    </button>
                                </div>
                            )}
                            {error && <p className="text-red-400 mt-4">{error}</p>}
                            {results && (
                                <div className="mt-6">
                                    <h2 className="text-xl font-bold text-white mb-4">Results</h2>
                                    {renderResults()}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
