<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSINT Investigation Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1a1c1e;
            color: #ffffff;
            display: flex;
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .sidebar {
            width: 60px;
            background-color: #2a2e32;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.4);
            position: fixed;
            height: 100%;
            z-index: 1000;
            transition: width 0.3s ease;
        }
        .sidebar.collapsed ~ .main-content .container .tab-content {
            margin-left: 60px;
        }
        .sidebar button {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 24px;
            padding: 15px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 5px 0;
            width: 100%;
            text-align: center;
            border-radius: 16px;
        }
        .sidebar button:hover {
            background-color: #3a3e42;
            transform: scale(1.1);
        }
        .sidebar button.active {
            background-color: #3a3e42;
        }
        .sidebar-toggle {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 20px;
            padding: 10px;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: -40px;
            display: none;
        }
        .sidebar.collapsed .sidebar-toggle {
            display: block;
        }
        .main-content {
            flex: 1;
            padding: 30px;
            margin-left: 60px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s ease;
        }
        .container {
            max-width: 1920px;
            margin: 0 auto;
            flex-grow: 1;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 25px;
            color: #ffffff;
            font-weight: 600;
            border-bottom: 2px solid #3a3e42;
            padding-bottom: 10px;
        }
        input, select, textarea {
            width: 70%;
            padding: 14px;
            margin-left: 10%;
            margin-bottom: 20px;
            background-color: #2a2e32;
            border: 1px solid #3d4a52;
            border-radius: 16px;
            color: #ffffff;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 8px rgba(74, 144, 226, 0.5);
        }
        button.primary {
            background-color: #4a90e2;
            color: #ffffff;
            padding: 14px 25px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: auto;
            margin-left: 10%;
        }
        button.primary:hover {
            background-color: #357abd;
            transform: translateY(-2px);
        }
        button.primary:disabled {
            background-color: #3d4a52;
            cursor: not-allowed;
        }
        .checkbox-group {
            display: flex;
            gap: 25px;
            margin-left: 10%;
            margin-bottom: 20px;
            align-items: center;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            color: #ffffff;
            font-weight: 500;
        }
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        .error {
            color: #e74c3c;
            margin-left: 10%;
            margin-top: 10px;
            font-size: 14px;
            font-weight: 500;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        .card {
            background: #2a2e32;
            border: 1px solid #3a3e42;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 200px;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        .card img.profile-pic {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            align-self: flex-start;
            border: 2px solid #4a90e2;
        }
        .card img.screenshot {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 12px;
        }
        .card .content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-wrap: break-word;
            word-wrap: break-word;
            max-height: 100%;
        }
        .card h3 {
            margin: 0 0 8px;
            font-size: 18px;
            color: #ffffff;
            font-weight: 600;
        }
        .card p {
            margin: 6px 0;
            color: #bdc3c7;
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            max-height: 100px;
        }
        .card .domain {
            color: #4a90e2;
            font-size: 12px;
            font-weight: 500;
            margin-top: 8px;
        }
        .section-title {
            font-size: 20px;
            margin: 20px 0 12px;
            color: #ffffff;
            font-weight: 600;
            border-bottom: 2px solid #3a3e42;
            padding-bottom: 4px;
        }
        @media (max-width: 1600px) {
            .card-grid {
                grid-template-columns: repeat(3, minmax(250px, 1fr));
            }
        }
        @media (max-width: 1280px) {
            .card-grid {
                grid-template-columns: repeat(2, minmax(250px, 1fr));
            }
        }
        @media (max-width: 1024px) {
            .card-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 50px;
            }
            .main-content {
                margin-left: 50px;
                padding: 15px;
            }
            .card-grid {
                grid-template-columns: 1fr;
            }
            input, select, textarea {
                width: 90%;
                margin-left: 5%;
            }
            button.primary {
                margin-left: 5%;
            }
            .checkbox-group {
                margin-left: 5%;
            }
            .error {
                margin-left: 5%;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <button data-tab="deep" title="Deep Investigation" class="active"><i class="bi bi-search"></i></button>
        <button data-tab="social" title="Social Media Search"><i class="bi bi-globe"></i></button>
        <button data-tab="advanced" title="Advanced Search"><i class="bi bi-zoom-in"></i></button>
        <button data-tab="capture" title="Website Capture"><i class="bi bi-camera"></i></button>
        <button data-tab="batch" title="Batch Investigation"><i class="bi bi-list-task"></i></button>
        <button data-tab="phone" title="Phone Number Search"><i class="bi bi-telephone"></i></button>
        <button data-tab="health" title="System Health"><i class="bi bi-heart-pulse"></i></button>
    </div>
    <div class="main-content">
        <div class="container">
            <div id="deep-tab" class="tab-content">
                <h1>Deep Investigation</h1>
                <input type="text" id="deep-username" placeholder="Enter username">
                <button class="primary" onclick="handleSearch('deep')">Start Investigation</button>
                <div id="deep-error" class="error"></div>
                <div id="deep-results" class="card-grid"></div>
            </div>
            <div id="social-tab" class="tab-content" style="display: none;">
                <h1>Social Media Search</h1>
                <input type="text" id="social-username" placeholder="Enter username">
                <select id="social-platform">
                    <option value="tiktok">TikTok</option>
                    <option value="facebook">Facebook</option>
                    <option value="instagram">Instagram</option>
                    <option value="youtube">YouTube</option>
                    <option value="twitter">Twitter</option>
                    <option value="linkedin">LinkedIn</option>
                    <option value="github">GitHub</option>
                    <option value="reddit">Reddit</option>
                </select>
                <button class="primary" onclick="handleSearch('social')">Search Social Media</button>
                <div id="social-error" class="error"></div>
                <div id="social-results" class="card-grid"></div>
            </div>
            <div id="advanced-tab" class="tab-content" style="display: none;">
                <h1>Advanced Search</h1>
                <input type="text" id="advanced-query" placeholder="Enter search query">
                <div class="checkbox-group">
                    <label><input type="checkbox" id="bing-source" checked> Bing</label>
                    <label><input type="checkbox" id="duckduckgo-source" checked> DuckDuckGo</label>
                </div>
                <button class="primary" onclick="handleSearch('advanced')">Execute Search</button>
                <div id="advanced-error" class="error"></div>
                <div id="advanced-results" class="card-grid"></div>
            </div>
            <div id="capture-tab" class="tab-content" style="display: none;">
                <h1>Website Capture</h1>
                <input type="text" id="capture-url" placeholder="Enter URL">
                <button class="primary" onclick="handleSearch('capture')">Capture & Analyze</button>
                <div id="capture-error" class="error"></div>
                <div id="capture-results" class="card-grid"></div>
            </div>
            <div id="batch-tab" class="tab-content" style="display: none;">
                <h1>Batch Investigation</h1>
                <textarea id="batch-usernames" placeholder="Enter usernames (one per line)" rows="5"></textarea>
                <button class="primary" onclick="handleSearch('batch')">Start Batch Analysis</button>
                <div id="batch-error" class="error"></div>
                <div id="batch-results" class="card-grid"></div>
            </div>
            <div id="phone-tab" class="tab-content" style="display: none;">
                <h1>Phone Number Search</h1>
                <input type="text" id="phone-username" placeholder="Enter username">
                <select id="phone-platform">
                    <option value="tiktok">TikTok</option>
                    <option value="facebook">Facebook</option>
                    <option value="instagram">Instagram</option>
                    <option value="youtube">YouTube</option>
                    <option value="twitter">Twitter</option>
                    <option value="linkedin">LinkedIn</option>
                    <option value="github">GitHub</option>
                    <option value="reddit">Reddit</option>
                </select>
                <button class="primary" onclick="handleSearch('phone')">Search Phone Number</button>
                <div id="phone-error" class="error"></div>
                <div id="phone-results" class="card-grid"></div>
            </div>
            <div id="health-tab" class="tab-content" style="display: none;">
                <h1>System Health</h1>
                <button class="primary" onclick="handleSearch('health')">Check System Health</button>
                <div id="health-error" class="error"></div>
                <div id="health-results" class="card-grid"></div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.8/dist/axios.min.js"></script>
    <script>
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.querySelector('.main-content');
        const toggleButton = document.createElement('button');
        toggleButton.className = 'sidebar-toggle';
        toggleButton.innerHTML = '<i class="bi bi-list"></i>';
        sidebar.appendChild(toggleButton);

        toggleButton.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('collapsed');
            mainContent.style.marginLeft = sidebar.classList.contains('collapsed') ? '50px' : '60px';
        });

        const tabs = document.querySelectorAll('.sidebar button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                tabContents.forEach(content => content.style.display = 'none');
                const activeTab = document.getElementById(`${tab.dataset.tab}-tab`);
                if (activeTab) activeTab.style.display = 'block';
                clearResults();
            });
        });

        function clearResults() {
            document.querySelectorAll('.card-grid').forEach(el => el.innerHTML = '');
            document.querySelectorAll('.error').forEach(el => el.innerHTML = '');
        }

        async function handleSearch(tab) {
            const errorEl = document.getElementById(`${tab}-error`);
            const resultsEl = document.getElementById(`${tab}-results`);
            const button = document.querySelector(`#${tab}-tab button.primary`);
            if (!button || !errorEl || !resultsEl) return;

            button.disabled = true;
            button.textContent = 'Processing...';
            errorEl.textContent = '';
            resultsEl.innerHTML = '';

            try {
                let response;
                const config = { timeout: 10000 };
                if (tab === 'deep') {
                    const username = document.getElementById('deep-username')?.value || '';
                    if (!username) throw new Error('Username is required');
                    response = await axios.post('/api/investigate', { username }, config);
                    renderDeepResults(response.data.investigation, resultsEl);
                } else if (tab === 'social') {
                    const username = document.getElementById('social-username')?.value || '';
                    const platform = document.getElementById('social-platform')?.value || '';
                    if (!username) throw new Error('Username is required');
                    response = await axios.post(`/api/search/${platform}`, { username }, config);
                    renderProfileResults(response.data.results, resultsEl);
                } else if (tab === 'advanced') {
                    const query = document.getElementById('advanced-query')?.value || '';
                    const sources = [];
                    if (document.getElementById('bing-source')?.checked) sources.push('bing');
                    if (document.getElementById('duckduckgo-source')?.checked) sources.push('duckduckgo');
                    if (!query) throw new Error('Query is required');
                    response = await axios.post('/api/advanced-search', { query, sources }, config);
                    renderProfileResults(response.data.results, resultsEl);
                } else if (tab === 'capture') {
                    const url = document.getElementById('capture-url')?.value || '';
                    if (!url) throw new Error('URL is required');
                    response = await axios.post('/api/capture', { url }, config);
                    renderCaptureResults(response.data.capture, resultsEl);
                } else if (tab === 'batch') {
                    const usernames = (document.getElementById('batch-usernames')?.value || '').split('\n').filter(u => u.trim());
                    if (!usernames.length) throw new Error('Usernames array is required');
                    response = await axios.post('/api/batch-investigate', { usernames }, config);
                    renderBatchResults(response.data.investigations, resultsEl);
                } else if (tab === 'phone') {
                    const username = document.getElementById('phone-username')?.value || '';
                    const platform = document.getElementById('phone-platform')?.value || '';
                    if (!username) throw new Error('Username is required');
                    response = await axios.post(`/api/search-phone/${platform}`, { username }, config);
                    renderPhoneResults(response.data.results, resultsEl);
                } else if (tab === 'health') {
                    response = await axios.get('/health', config);
                    renderHealthResults(response.data, resultsEl);
                }
            } catch (err) {
                errorEl.textContent = err.response?.data?.error || err.message || 'An error occurred';
                if (err.code === 'ECONNABORTED') errorEl.textContent = 'Request timed out';
            } finally {
                button.disabled = false;
                const defaultTexts = {
                    deep: 'Start Investigation',
                    social: 'Search Social Media',
                    advanced: 'Execute Search',
                    capture: 'Capture & Analyze',
                    batch: 'Start Batch Analysis',
                    phone: 'Search Phone Number',
                    health: 'Check System Health'
                };
                button.textContent = defaultTexts[tab] || 'Process';
            }
        }

        function renderCard(content) {
            return `<div class="card">${content ? `<div class="content">${content}</div>` : ''}</div>`;
        }

        function getShortDomain(url) {
            try {
                return new URL(url).hostname.replace('www.', '').split('.').slice(-2).join('.') || 'unknown';
            } catch {
                return 'unknown';
            }
        }

        function renderProfileCard(profile) {
            const domain = getShortDomain(profile.url || '');
            return renderCard(`
                <div style="display: flex; align-items: flex-start;">
                    ${profile.profilePic ? `<img src="${profile.profilePic}" class="profile-pic" alt="Profile">` : ''}
                    <div>
                        <h3>${profile.title || 'Unknown'}</h3>
                        <p>Platform: ${profile.platform || 'N/A'}</p>
                        <div class="domain">${domain}</div>
                    </div>
                </div>
                ${profile.bio ? `<p>Bio: ${profile.bio}</p>` : ''}
                ${profile.followers ? `<p>Followers: ${profile.followers}</p>` : ''}
                ${profile.postCount ? `<p>Posts: ${profile.postCount}</p>` : ''}
                ${profile.snippet ? `<p>${profile.snippet}</p>` : ''}
                ${profile.screenshot ? `<img src="${profile.screenshot}" class="screenshot" alt="Screenshot">` : ''}
            `);
        }

        function renderCaptureCard(capture) {
            const domain = getShortDomain(capture.url || '');
            return renderCard(`
                <h3>${capture.title || 'Website Capture'}</h3>
                <div class="domain">${domain}</div>
                ${capture.description ? `<p>${capture.description}</p>` : ''}
                ${capture.screenshot ? `<img src="${capture.screenshot}" class="screenshot" alt="Screenshot">` : ''}
                ${capture.error ? `<p class="error">Error: ${capture.error}</p>` : ''}
            `);
        }

        function renderPhoneCard(profile) {
            const domain = getShortDomain(profile.url || '');
            return renderCard(`
                <div style="display: flex; align-items: flex-start;">
                    ${profile.profilePic ? `<img src="${profile.profilePic}" class="profile-pic" alt="Profile">` : ''}
                    <div>
                        <h3>${profile.title || 'Unknown'}</h3>
                        <p>Platform: ${profile.platform || 'N/A'}</p>
                        <div class="domain">${domain}</div>
                    </div>
                </div>
                ${profile.phone ? `<p>Phone: ${profile.phone}</p>` : '<p>No phone number found</p>'}
                ${profile.screenshot ? `<img src="${profile.screenshot}" class="screenshot" alt="Screenshot">` : ''}
            `);
        }

        function renderDeepResults(investigation, resultsEl) {
            let html = '';
            if (investigation?.social_media) {
                Object.entries(investigation.social_media).forEach(([platform, profiles]) => {
                    if (profiles?.length) {
                        html += `<h2 class="section-title">${platform.charAt(0).toUpperCase() + platform.slice(1)}</h2>`;
                        html += '<div class="card-grid">';
                        profiles.forEach(profile => {
                            html += renderProfileCard(profile || {});
                        });
                        html += '</div>';
                    }
                });
            }
            if (investigation?.general_search?.length) {
                html += '<h2 class="section-title">General Search</h2>';
                html += '<div class="card-grid">';
                investigation.general_search.forEach(result => {
                    html += renderProfileCard(result || {});
                });
                html += '</div>';
            }
            resultsEl.innerHTML = html || '<p>No results found</p>';
        }

        function renderProfileResults(profiles, resultsEl) {
            let html = '<div class="card-grid">';
            (profiles || []).forEach(profile => {
                html += renderProfileCard(profile || {});
            });
            html += '</div>';
            resultsEl.innerHTML = html || '<p>No results found</p>';
        }

        function renderCaptureResults(capture, resultsEl) {
            resultsEl.innerHTML = renderCaptureCard(capture || {});
        }

        function renderBatchResults(investigations, resultsEl) {
            let html = '';
            (investigations || []).forEach(investigation => {
                if (investigation?.username) {
                    html += `<h2 class="section-title">Username: ${investigation.username}</h2>`;
                    if (investigation?.social_media) {
                        Object.entries(investigation.social_media).forEach(([platform, profiles]) => {
                            if (profiles?.length) {
                                html += `<h3>${platform.charAt(0).toUpperCase() + platform.slice(1)}</h3>`;
                                html += '<div class="card-grid">';
                                profiles.forEach(profile => {
                                    html += renderProfileCard(profile || {});
                                });
                                html += '</div>';
                            }
                        });
                    }
                }
            });
            resultsEl.innerHTML = html || '<p>No results found</p>';
        }

        function renderPhoneResults(profiles, resultsEl) {
            let html = '<div class="card-grid">';
            (profiles || []).forEach(profile => {
                html += renderPhoneCard(profile || {});
            });
            html += '</div>';
            resultsEl.innerHTML = html || '<p>No results found</p>';
        }

        function renderHealthResults(data, resultsEl) {
            resultsEl.innerHTML = renderCard(`
                <h2 class="section-title">System Health</h2>
                <p><strong>Status:</strong> ${data?.status || 'Unknown'}</p>
                <p><strong>Version:</strong> ${data?.version || 'N/A'}</p>
                <p><strong>Uptime:</strong> ${Math.round(data?.uptime) || 0} seconds</p>
                <p><strong>Supported Platforms:</strong> ${(data?.supported_platforms || []).join(', ') || 'N/A'}</p>
                <p><strong>Features:</strong> ${(data?.features || []).join(', ') || 'N/A'}</p>
            `);
        }
    </script>
</body>
</html>
